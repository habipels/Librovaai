{% extends 'frontend/base.html' %}
{% load static %}

{% block title %}Kitap Yükle - Librovaai{% endblock %}

{% block content %}
<div class="container" style="margin-top: 30px; margin-bottom: 30px;">
    
    <div class="row">
        <div class="col-md-8 col-md-offset-2">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <h3 class="panel-title"><i class="fa fa-upload"></i> Yeni Kitap Yükle</h3>
                </div>
                <div class="panel-body">
                    
                    <form method="POST" enctype="multipart/form-data">
                        {% csrf_token %}
                        
                        <!-- Kitap Başlığı -->
                        <div class="form-group">
                            <label for="title">Kitap Başlığı *</label>
                            <input type="text" name="title" id="title" class="form-control" required>
                        </div>

                        <!-- Alt Başlık -->
                        <div class="form-group">
                            <label for="subtitle">Alt Başlık</label>
                            <input type="text" name="subtitle" id="subtitle" class="form-control">
                        </div>

                        <!-- Açıklama -->
                        <div class="form-group">
                            <label for="description">Kitap Açıklaması</label>
                            <textarea name="description" id="description" class="form-control" rows="5" 
                                      placeholder="Kitabınızın kısa açıklamasını yazın..."></textarea>
                        </div>

                        <!-- Kategoriler -->
                        <div class="form-group">
                            <label>Kategoriler *</label>
                            <select name="categories" id="categories" class="form-control" multiple required>
                                {% for category in categories %}
                                    <option value="{{ category.id }}">{{ category.name }}</option>
                                {% endfor %}
                            </select>
                            <small class="help-block">Ctrl tuşuna basılı tutarak birden fazla kategori seçebilirsiniz.</small>
                        </div>

                        <!-- Dosya Yükleme -->
                        <div class="form-group">
                            <label for="file">Kitap Dosyası (PDF veya Word) *</label>
                            <input type="file" name="file" id="file" class="form-control" 
                                   accept=".pdf,.doc,.docx" required>
                            <small class="help-block">Kabul edilen formatlar: PDF, DOC, DOCX (Max: 50MB)</small>
                        </div>

                        <!-- Kapak Görseli -->
                        <div class="form-group">
                            <label for="cover_image">Kapak Görseli</label>
                            <input type="file" name="cover_image" id="cover_image" class="form-control" 
                                   accept="image/*">
                            <small class="help-block">Önerilen boyut: 600x800px</small>
                        </div>

                        <hr>

                        <!-- Yayıncı Bilgileri -->
                        <h4>Yayıncı Bilgileri (Opsiyonel)</h4>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="publisher">Yayınevi</label>
                                    <input type="text" name="publisher" id="publisher" class="form-control">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="isbn">ISBN</label>
                                    <input type="text" name="isbn" id="isbn" class="form-control">
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="publication_year">Yayın Yılı</label>
                                    <input type="number" name="publication_year" id="publication_year" 
                                           class="form-control" min="1900" max="2100">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="page_count">Sayfa Sayısı</label>
                                    <input type="number" name="page_count" id="page_count" 
                                           class="form-control" min="1">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="language">Dil</label>
                                    <select name="language" id="language" class="form-control">
                                        <option value="Türkçe">Türkçe</option>
                                        <option value="İngilizce">İngilizce</option>
                                        <option value="Almanca">Almanca</option>
                                        <option value="Fransızca">Fransızca</option>
                                        <option value="Diğer">Diğer</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <hr>

                        <!-- AI İşleme -->
                        <div class="form-group">
                            <div class="checkbox">
                                <label>
                                    <input type="checkbox" name="process_with_ai" value="1" checked>
                                    <strong>Kitabımı AI ile işle</strong>
                                    <br>
                                    <small class="text-muted">
                                        AI, kitabınızı analiz edecek, içindekiler çıkaracak ve özet oluşturacaktır. 
                                        (Bu işlem birkaç dakika sürebilir)
                                    </small>
                                </label>
                            </div>
                        </div>

                        <!-- Durum -->
                        <div class="form-group">
                            <label>Durum</label>
                            <div class="radio">
                                <label>
                                    <input type="radio" name="status" value="pending" checked>
                                    <strong>Admin Onayına Gönder</strong>
                                    <br><small>Kitabınız admin onayından sonra yayınlanacak</small>
                                </label>
                            </div>
                            <div class="radio">
                                <label>
                                    <input type="radio" name="status" value="draft">
                                    <strong>Taslak Olarak Kaydet</strong>
                                    <br><small>Daha sonra düzenleyip onaya gönderebilirsiniz</small>
                                </label>
                            </div>
                        </div>

                        <hr>

                        <!-- Buttons -->
                        <div class="form-group">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fa fa-upload"></i> Kitabı Yükle
                            </button>
                            <a href="{% url 'author_dashboard' %}" class="btn btn-default btn-lg">
                                <i class="fa fa-times"></i> İptal
                            </a>
                        </div>

                    </form>

                </div>
            </div>

            <!-- Yükleme Bilgilendirmesi -->
            <div class="alert alert-info">
                <h4><i class="fa fa-info-circle"></i> Önemli Bilgiler:</h4>
                <ul>
                    <li>Yükleyeceğiniz kitap telif haklarına uygun olmalıdır.</li>
                    <li>Maksimum dosya boyutu 50MB'dir.</li>
                    <li>AI işleme seçeneği seçilirse, kitabınız otomatik olarak analiz edilecektir.</li>
                    <li>Kitabınız admin onayından geçtikten sonra yayınlanacaktır.</li>
                    <li>Reddedilen kitaplar için red nedeni belirtilecektir.</li>
                </ul>
            </div>

        </div>
    </div>

</div>

<script>
// Form gönderilirken loading göster
document.querySelector('form').addEventListener('submit', function() {
    var btn = document.querySelector('button[type="submit"]');
    btn.innerHTML = '<i class="fa fa-spinner fa-spin"></i> Yükleniyor...';
    btn.disabled = true;
});
</script>
{% endblock %}
